<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="wrap">
        <div class="head">
            <div class="head-top">
                <!-- log区域 -->
                <h1 class="logo">
                    <a href="#">
                        <img src="img/logo.png">
                    </a>
                </h1>
                <!-- 面包屑导航 -->
                <a href="javascript:;" class="menuBtn">
                </a>
                <!-- 排按钮 -->
                <div class="btns">
                    <a href="javascript:;" class="search">搜索</a>
                    <a href="javascript:;">登录</a>
                    <a href="javascript:;">注册</a>
                </div>
            </div>
            <div class="head-bottom">
                <form method="post">
                    <input type="text" placeholder="点我搜索">
                    <input type="submit" value="搜索">
                </form>
            </div>
            <ul class="mask">
                <li>
                    <a href="javascript:;">首页</a>
                </li>
                <li>
                    <a href="javascript:;">MV</a>
                </li>
                <li>
                    <a href="javascript:;">悦单</a>
                </li>
                <li>
                    <a href="javascript:;">V榜</a>
                </li>
                <li>
                    <a href="javascript:;">音乐</a>
                </li>
                <li>
                    <a href="javascript:;">商城</a>
                </li>
                <li>
                    <a href="javascript:;">节目</a>
                </li>
                <li>
                    <a href="javascript:;">饭团</a>
                </li>
                <li>
                    <a href="javascript:;">咨询</a>
                </li>
                <li>
                    <a href="javascript:;">我的家</a>
                </li>
                <li>
                    <a href="javascript:;">APP下载</a>
                </li>
                <li>
                    <a href="javascript:;">热门应用</a>
                </li>
            </ul>
        </div>
        <div class="content">
            <!-- 导航 -->
            <div class="nav">
                <ul class="list">
                    <li>
                        <a href="javascript:;" class="active">首页</a>
                    </li>
                    <li>
                        <a href="javascript:;">MV</a>
                    </li>
                    <li>
                        <a href="javascript:;">悦单</a>
                    </li>
                    <li>
                        <a href="javascript:;">V榜</a>
                    </li>
                    <li>
                        <a href="javascript:;">音乐</a>
                    </li>
                    <li>
                        <a href="javascript:;">商城</a>
                    </li>
                    <li>
                        <a href="javascript:;">节目</a>
                    </li>
                    <li>
                        <a href="javascript:;">饭团</a>
                    </li>
                    <li>
                        <a href="javascript:;">咨询</a>
                    </li>
                    <li>
                        <a href="javascript:;">我的家</a>
                    </li>
                    <li>
                        <a href="javascript:;">APP下载</a>
                    </li>
                    <li>
                        <a href="javascript:;">热门应用</a>
                    </li>
                    <li>
                        <a href="javascript:;">ABC</a>
                    </li>
                    <li>
                        <a href="javascript:;">DEF</a>
                    </li>
                    <li>
                        <a href="javascript:;">GHI</a>
                    </li>
                    <li>
                        <a href="javascript:;">JKL</a>
                    </li>
                </ul>
            </div>
            <!-- 轮播图 -->
            <div class="carousel-warp" needCarousel>
                <div class="points-wrap" ></div>
            </div>
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="tap-loading">
                    </ul>
                    <ul>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tap-loading">
                    </ul>
                </div>
            </div>
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript">全部</a>
                    <a href="javascript">内地</a>
                    <a href="javascript">港台</a>
                    <a href="javascript">欧美</a>
                    <a href="javascript">韩国</a>
                    <a href="javascript">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="tap-loading">
                    </ul>
                    <ul>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript">
                                <img src="img/a.jpg" alt="">
                                <span>歌名测试</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span class="playCount">9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span class="playCount">6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tap-loading">
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script src="js/tools.js"></script>
    <script src="js/transform.js"></script>
    <script>
        window.onload=function(){
            document.addEventListener('touchstart',function(ev){
                ev = ev||event
                ev.preventDefault();
            },{passive: false})

            ;(
                function(){
                    var styleNode = document.createElement('style')
                    var w = document.documentElement.clientWidth/16
                    styleNode.innerHTML += "html{font-size:"+w+"px!important}"
                    document.head.appendChild(styleNode)
                }
            )()

            /*
                一次move过程
                    touchstart 事件触发一次
                    touchmove 事件触发n次
                    touchend 事件触发一次

                1.基本的滑屏逻辑（防抖动）
                2.结合tap选项卡的实际需求  滑屏
                    --- 手指一次move过程没有过1/2
                            我们不关心touchmove的触发次数
                    --- 手指一次move过程过1/2
                            0
                            -2w
                            touchmove的触发次数必须只有一次

                3.一个逻辑只被触发一次
                    定时器
                        控制一个逻辑在一定时间内被触发一次
                    立flag
                        控制一个逻辑在一类操作过程中被触发一次
            */


            
            tap()
            // tap选项卡
            function tap(){
                var  wrap = document.querySelector("#wrap .content .tap-wrap");
				var  contentNodes = document.querySelectorAll("#wrap .content .tap-wrap .tap-content");
				var w = wrap.offsetWidth;
				for(var i=0;i<contentNodes.length;i++){
					move(contentNodes[i]);
				}
				
				
				function move(content){
                    // 抽象化标签下标
                    var now = 0
                    var smallG = content.parentNode.querySelector('.tap-nav .smallG')
				    var  loaddings = document.querySelectorAll("#wrap .content .tap-wrap .tap-content .tap-loading");
                    var aNodes = content.parentNode.querySelectorAll('.tap-nav a')
                    smallG.style.width=aNodes[0].offsetWidth+'px'

					damu.css(content,"translateX",-w);

                    var startX = {x:0,y:0}
                    var elementX = {x:0,y:0}

                    var isFirst = true;
                    var isX = true;
                    var isOver = false;
                    content.addEventListener('touchstart',function(ev){
                        ev=ev||event
                        isOver = false;
                        if(isOver){
                            return
                        }
                        var touchC = ev.changedTouches[0];
                        startX.x = touchC.clientX;
                        startX.y = touchC.clientY;
                        elementX.x = damu.css(content,"translateX")
                        elementX.y = damu.css(content,"translateY")

                        isFirst = true;
                        isX = true;
                        isOver = false;
                    })
                    content.addEventListener('touchmove',function(ev){
                        ev=ev||event
                        if(isOver){
                            return
                        }
                        if(!isX){
                            return
                        }
                        var touchC = ev.changedTouches[0];
                        var nowX = {x:0,y:0}
                        var dis = {x:0,y:0}
                        nowX.x = touchC.clientX
                        nowX.y = touchC.clientY

                        dis.x = nowX.x - startX.x
                        dis.y = nowX.y - startX.y
                        
                        if(isFirst){
                            isFirst = false;
                            if(Math.abs(dis.y)>Math.abs(dis.x)){
                                isX = false;
                            }
                        }
                        
                        var translateX = elementX.x + dis.x
                        damu.css(content,"translateX",translateX)
                        jump(dis.x)
                    })
                    content.addEventListener('touchend',function(ev){
                        ev=ev||event
                        if(isOver){
                            return
                        }
                        var touchC = ev.changedTouches[0];
                        var nowX = {x:0,y:0}
                        var dis = {x:0,y:0}
                        nowX.x = touchC.clientX

                        dis.x = nowX.x - startX.x

                        if(Math.abs(dis.x)<=w/2){
                            content.style.transition = '1s transform'
                            damu.css(content,"translateX",-w)
                        }
                    })
                    
                    function jump(disX){
                        if(isOver){
                            return
                        }
                        if(Math.abs(disX)>w/2){
                            isOver = true;
                            content.style.transition = '1s transform'
                            // if(disX>0){
                            //     damu.css(content,"translateX",0)
                            // }else{
                            //     damu.css(content,"translateX",-2*w)
                            // }
                            var targetX = disX>0?0:-2*w;
							damu.css(content,"translateX",targetX);

                            // 请求一定要在动画执行完毕后再发
                            content.addEventListener('transitionend',endFn)
                            content.addEventListener('webkitTransitionEnd',endFn)

                            function endFn(){
                            content.style.transition = 'none'
                                /*
                                    循环定时器  回调函数的头部第一行清定时器
                                    DOM2 绑定 transitionend事件 回调函数的头部第一行解绑事件
                                */

                                content.addEventListener('transitionend',endFn)
                                content.addEventListener('webkitTransitionEnd',endFn)
                                /*
                                当用户滑动超过1/2时
                                    1.一开始loading图是隐藏的，loadding图需要出现
                                    2.发送请求 处理请求  完成数据的渲染
                                        必须动画（content去0或者-2w位置）完成之后，再去执行后面的一系列逻辑
                                            content要回到-w的位置

                                */
                                for(var i=0;i<loaddings.length;i++){
                                    loaddings[i].style.opacity = 1

                                }

                                // 对now进行控制
                                disX>0? now--:now++
                                if(now<0){
                                    now = aNodes.length-1
                                }else if(now>aNodes.length-1){
                                    now = 0
                                }
                                console.log(now);
                                damu.css(smallG,"translateX",aNodes[now].offsetLeft)
                                // 发ajax请求  去服务端拿数据
                                setTimeout(function(){
                                    for(var i=0;i<loaddings.length;i++){
                                    loaddings[i].style.opacity = 0
                                    }
                                    damu.css(content,'translateX',-w)
                                },2000)
                            }
                        }
                    }
                }
            }

            changeColor()
            // 导航点击变色
            function changeColor(){
                var listNodes = document.querySelector('#wrap .content .nav .list')
                var aNodes = document.querySelectorAll('#wrap .content .nav .list>li a')
                listNodes.addEventListener('touchstart',function(ev){
                    ev=ev||event
                    this.isMove=false;
                })
                listNodes.addEventListener('touchmove',function(ev){
                    ev=ev||event
                    this.isMove=true
                })
                listNodes.addEventListener('touchend',function(ev){
                    ev=ev||event
                    if(this.isMove){
                        return
                    }
                    var touchC = ev.changedTouches[0]
                    for(var i = 0;i<aNodes.length;i++){
                        tools.removeClass(aNodes[i],'active')
                    }
                    tools.addClass(touchC.target,'active')
                })
            }

            // 无缝滑屏
            swiper()
            function swiper(){
                var imgArr= ['./img/1.jpg','./img/2.jpg','./img/3.jpg','./img/4.jpg','./img/5.jpg']
                damu.carousel(imgArr);
            }
            changeFocus();
            // 恢复input被阻止的焦点事件
            function changeFocus(){
                var inputText = document.querySelector('#wrap .head .head-bottom form input[type="text"]')
                inputText.addEventListener('touchstart',function(ev){
                    ev=ev||event
                    // 获取input焦点
                    this.focus();
                    // 阻止冒泡
                    ev.stopPropagation();
                    ev.preventDefault();
                })
                document.addEventListener('touchstart',function(ev){
                    inputText.blur()
                })
            }
            CMCFMenuBtn()
            // 点击时展开导航菜单
            function CMCFMenuBtn(){
                var menuBtn = document.querySelector('#wrap .head .head-top .menuBtn')
                var mask = document.querySelector('#wrap .head .mask')
                var isShow = false;
                console.log(menuBtn);
                menuBtn.addEventListener("touchstart",function(ev){
                    ev=ev||event
                    // 获取手指
                    var touchC = ev.changedTouches[0];
                    if(!isShow){
                        tools.addClass(menuBtn,"active")
                        mask.style.display="block"
                    }else{
                        tools.removeClass(menuBtn,"active")
                        mask.style.display="none"
                    }
                    isShow = !isShow
                    // 取消冒泡
                    ev.stopPropagation();
                    // 取消冒泡会使阻止默认事件失效，需要重新设置
                    ev.preventDefault();
                })

                // 点击菜单外的位置隐藏菜单
                document.addEventListener("touchstart",function(ev){
                    if(isShow){
                        tools.removeClass(menuBtn,"active")
                        mask.style.display="none"
                        isShow = false

                    }
                })

                mask.addEventListener("touchstart",function(ev){
                    ev=ev||event
                    // 取消冒泡
                    ev.stopPropagation();
                    // 取消冒泡会使阻止默认事件失效，需要重新设置
                    ev.preventDefault();
                })

            }

            damu.move();
            // 实现滚屏效果
            
        }
    </script>
</body>
</html> 